<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>ColsonElliott-Homerun</title>
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>

    <script>
      // get text to face camera always
      AFRAME.registerComponent('face-camera', {
        schema: { target: { type: 'selector' } },
        init: function () {
          if (!this.data.target) {
            this.data.target = this.el.sceneEl.camera && this.el.sceneEl.camera.el;
          }
          this._camWorld = new THREE.Vector3();
        },
        tick: function () {
          const targetEl = this.data.target;
          if (!targetEl || !targetEl.object3D) return;
          targetEl.object3D.getWorldPosition(this._camWorld);
          this.el.object3D.lookAt(this._camWorld);
        }
      });
    </script>
  </head>

  <body>
    <a-scene>
  
      <a-assets>
        <img id="stadiumSky" src="assets/equirectangularFieldphotoshop.jpg">
        <img id="grassTex" src="assets/Grasstexture.jpg">
        <a-asset-item id="baseObj" src="assets/Home Plate/model.obj"></a-asset-item>
        <img id="baseTex" src="assets/Home Plate/BaseTexture.png">
        <a-asset-item id="ballObj" src="assets/Baseball/baseball.obj"></a-asset-item>
        <img id="baseballTex" src="assets/Baseball/baseballTxt.jpg">
      </a-assets>

      <a-sky src="#stadiumSky" radius="40"></a-sky>

      <!-- camera start placement -->
      <a-entity position="16 1.6 -16" rotation="0 135 0">
        <a-entity id="player" camera wasd-controls look-controls></a-entity>
      </a-entity>

      <!-- field -->
      <a-plane rotation="-90 0 0" width="50" height="50"
               material="src: #grassTex; repeat: 20 20;"></a-plane>
      
      <a-box id="first"
             position="10 0 10"
             depth="2" height="0.2" width="2"
             material="src: #baseTex">
      </a-box>

      <a-box id="second"
             position="-10 0 10"
             depth="2" height="0.2" width="2"
             material="src: #baseTex">
      </a-box>

      <a-box id="third"
             position="-10 0 -10"
             depth="2" height="0.2" width="2"
             material="src: #baseTex">
      </a-box>

      <a-entity id="home"
                obj-model="obj: #baseObj"
                position="10 0.1 -10"
                rotation="0 45 0"
                scale="2 2 2">
      </a-entity>

      <a-entity id="baseball"
                obj-model="obj: #ballObj"
                position="0 0.4 10"
                scale="1 1 1"
                material="src: #baseballTex">
      </a-entity>

      <a-cylinder position="0 0.1 0" radius="2" height="0.2" color="#8B4513"></a-cylinder>

      <a-box position="0 0.2 0" depth="0.4" height="0.05" width="2"
             color="white" rotation="0 135 0"></a-box>

      <a-text id="hud" value="Run the bases!" position="0 2.5 0"
              align="center" color="yellow" scale="3 3 3"
              material="side: double" face-camera="target: #player"></a-text>

    </a-scene>

    <!-- baserunning logic -->
    <script>
      const player = document.querySelector('#player');
      const hud = document.querySelector('#hud');
      const bases = ['first','second','third','home'];

      let nextBaseIndex = 0;

      function getWorldPosition(el) {
        const pos = new THREE.Vector3();
        el.object3D.getWorldPosition(pos);
        return pos;
      }

      function checkCollision() {
        const playerPos = getWorldPosition(player);
        const baseId = bases[nextBaseIndex];
        const baseEl = document.querySelector('#' + baseId);
        const basePos = getWorldPosition(baseEl);

        if (playerPos.distanceTo(basePos) < 2.5) {
          if (baseId === 'first')  hud.setAttribute('value','Single!');
          if (baseId === 'second') hud.setAttribute('value','Double!');
          if (baseId === 'third')  hud.setAttribute('value','Triple!');
          if (baseId === 'home')   hud.setAttribute('value','Home Run!');

          nextBaseIndex = (nextBaseIndex + 1) % bases.length;
        }
      }

      setInterval(checkCollision, 300);
    </script>

  </body>
</html>

